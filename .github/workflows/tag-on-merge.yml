name: Create semantic versioning tag
description: Create and push semantic versioning tag on push to main

on:
  push:
    branches:
      - main

jobs:
  tag-release:
    name: ðŸ”– Tag Merged Version
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ’¾ Checkout Repository
        uses: actions/checkout@v4

      - name: ðŸ”§ Setup Git User
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"

      - name: ðŸ§ª Detect Version Bump Commit
        id: check
        run: |
          COMMIT_MSG=$(git log -1 --pretty=%B)
          echo "Last commit message: $COMMIT_MSG"
          if [[ "$COMMIT_MSG" == chore(release):* ]]; then
            echo "is_bump=true" >> $GITHUB_OUTPUT
          else
            echo "is_bump=false" >> $GITHUB_OUTPUT
          fi

      - name: ðŸ”– Create and Push Git Tag
        if: steps.check.outputs.is_bump == 'true'
        run: |
          VERSION=$(node -p 'require("./package.json").version')
          echo "Creating tag: v$VERSION"
          git tag "v$VERSION"
          git push origin "v$VERSION"
